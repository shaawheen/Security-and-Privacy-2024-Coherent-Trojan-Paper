# Coherent Trojan Tool

This GitHub repository aggregates the artifacts of the paper "Coherent Trojans: Achilles’ Heel of Heterogeneous Computing" submitted to ACM CCS 25. Specifically, the **Trojan Tool** is a runtime configurable tool designed with a dual purpose – advancing practical research and serving as a hackers’ playground. It was developed to serve as a ”Swiss army knife” for coherence attacks on the considered system architecture and allow the creation of endless Coherent Trojans.
## Repo Structure

**Hardware**
- All [hardware](./hardware/README.md) artifacts used to build the Trojan Tool.

**Software**
- All [software](./software/README.md) artifacts used to build the Trojan Tool.

**Results**
- All experiments/attacks are made reproducible in this folder. These attacks show a fraction of the potentiality of the Trojan Tool and Coherent Trojans.
	- [Deanonymization Attack](./results/Deanonymization/001_match_pattern_may_27/README.md): Can subvert both 1st and 2nd-stage virtual memory translation, i.e., OS and hypervisor, as well as obfuscation techniques like [ASLR](https://en.wikipedia.org/wiki/Address_space_layout_randomization);
	- [Confidentiality Attack](./results/Confidentiality/002_rsa_key_leak_POC_mar_19/README.md): Leak RSA private key from [OpenSSL](https://www.openssl.org/);
	- [Integrity Attack](./results/Integrity/003_priv_escal_POC_mar_22/README.md): Privilege escalation attack on Linux. Elevates the privilege level of user-space applications (EL0) to root (EL1), subverting Linux superuser authentication;
	- [Availability Attack](./results/Availability/001_deg_perf_POC_may_2/README.md): Degrades performance of a safety-critical application (Tested on [RT-Bench](https://rt-bench.gitlab.io/rt-bench/branch/main/index.html)).

---
## Note

We assume you are running a standard Linux distro (e.g., Debian) and have Vivado already installed (any version of Vivado should work, our reproducible setup is version-agnostic).

---
## -1. Install dependencies

We use Nix to ensure the reproducibility of the Trojan Tool regardless of the setup environment. If you don't have Nix, you can learn more about it [here](https://nixos.org/).

Install Nix:

```
curl -L https://nixos.org/nix/install | sh -s -- --daemon
```

---
## 1. Setup base environment

Clone this repo and cd to it:

```
git clone https://github.com/ESCristiano/devil-in-the-fpga.git
cd devil-in-the-fpga
```

---
## 2. "Build" Hardware

```
cd ./hardware
./build_design.sh
./save_artifacts.sh
```

---
## 3. "Build" Software

```
cd ./software
nix-build
```

And all the needed source and images will be automatically downloaded and built.

---
## 4. Flash The SD Card

Plug the SD card and execute:

```
./result-9 #This script is generated by nix, that's why it has a strange name
```

---
## 5. Power Up the Board

Power up the system, stop the u-boot and insert the command:

- If you want to use a Hypervisor (we have support for [Bao](https://github.com/bao-project/bao-hypervisor), but any other hypervisor would work):

```
fatload mmc 0 0x200000 bao.img; bootm start 0x200000; bootm loados; bootm go
```

- **Or** if you don't want to use a Hypervisor:

```
fatload mmc 0 0x00200000 linux.bin && go 0x00200000
```

---
## A. Supported Platforms

**Armv8-A AArch64**

-  Xilinx Zynq UltraScale+ MPSoC ZCU102/4 ([TRM](https://docs.amd.com/r/en-US/ug1085-zynq-ultrascale-trm))